<!DOCTYPE html>
<!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ -->
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>编辑用户信息</title>
    <!-- Bootstrap core CSS -->
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link th:href="@{/css/dashboard.css}" rel="stylesheet">
    <style type="text/css">
        /* Chart.js */
        
        @-webkit-keyframes chartjs-render-animation {
            from {
                opacity: 0.99
            }
            to {
                opacity: 1
            }
        }
        
        @keyframes chartjs-render-animation {
            from {
                opacity: 0.99
            }
            to {
                opacity: 1
            }
        }
        
        .chartjs-render-monitor {
            -webkit-animation: chartjs-render-animation 0.001s;
            animation: chartjs-render-animation 0.001s;
        }
    </style>
</head>

<body>
    <div th:replace="~{commons/common::topbar}"></div>
    <div class="container-fluid">
        <div class="row">
            <div th:replace="~{commons/common::sidebar(active='user')}"></div>
            <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
                <h2>编辑用户信息</h2>
                <form method="post" th:action="${user?.userId != null} ? @{'/user/update'} : @{'/user/add'}">
                    <input type="hidden" name="userId" th:value="${user?.userId}">
                    <div class="form-group" th:if="${user?.userId != null}">
                        <label for="userId">用户ID：</label>
                        <input type="text" th:value="${user?.userId}" class="form-control" id="userId" readonly>
                        <small class="form-text text-muted">用户ID新增后不可修改</small>
                    </div>
                    <div class="form-group">
                        <label for="username">用户名：</label>
                        <input type="text" name="username" th:value="${user?.username}" class="form-control" id="username" 
                               placeholder="请输入用户名" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">手机号：</label>
                        <input type="text" name="phone" th:value="${user?.phone}" class="form-control" id="phone" 
                               placeholder="请输入手机号" required pattern="[0-9]{11}" title="请输入11位手机号">
                    </div>
                    <div class="form-group">
                        <label for="password">密码：</label>
                        <input type="password" name="password" th:value="${user?.password}" class="form-control" id="password" 
                               th:required="${user?.userId == null}" placeholder="请输入密码">
                        <small class="form-text text-muted" th:if="${user?.userId != null}">修改时如果不输入密码，将保留原密码</small>
                    </div>
                    <div class="form-group">
                        <label for="roleId">角色：</label>
                        <select name="roleId" class="form-control" id="roleId" 
                                th:readonly="${user?.userId != null}" required>
                            <option value="">请选择角色</option>
                            <option th:each="role : ${roleList}" 
                                    th:value="${role.roleId}" 
                                    th:text="${role.roleName} + ' (' + ${role.roleId} + ')'"
                                    th:selected="${user?.roleId == role.roleId}">
                            </option>
                        </select>
                        <small class="form-text text-muted" th:if="${user?.userId != null}">角色新增后不可修改</small>
                    </div>
                    <button type="submit" class="btn btn-primary">保存</button>
                    <button type="reset" class="btn btn-secondary">重置</button>
                    <a class="btn btn-outline-secondary" href="/user/list">返回</a>
                </form>
            </main>
        </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript" th:src="@{/js/jquery-3.2.1.slim.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/popper.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>

    <!-- Icons -->
    <script type="text/javascript" th:src="@{/js/feather.min.js}"></script>
    <script>
        feather.replace()
        
        // 表单提交前的验证
        document.querySelector('form').addEventListener('submit', function(e) {
            let roleId = document.getElementById('roleId').value;
            if (roleId && !/^[A-Z]+$/.test(roleId)) {
                alert('角色ID必须为大写字母');
                e.preventDefault();
                return false;
            }
            
            let phone = document.getElementById('phone').value;
            if (phone && !/^[0-9]{11}$/.test(phone)) {
                alert('请输入11位手机号');
                e.preventDefault();
                return false;
            }
        });
    </script>

</body>

</html>